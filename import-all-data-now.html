<!DOCTYPE html>
<html>
<head><title>Import All Data</title></head>
<body>
  <h1>Importing All Data...</h1>
  <pre id="output">Starting import...</pre>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
    
    const supabase = createClient(
      'https://nuhfqkhplldontxtoxkg.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im51aGZxa2hwbGxkb250eHRveGtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4NzQyODYsImV4cCI6MjA3MzQ1MDI4Nn0.ceTZ_YZtqCRv2v3UCgHM42OXdb97KrmVhnxgk0iD3eE'
    );
    
    const output = document.getElementById('output');
    
    try {
      // Load files
      const drugsResp = await fetch('exported-drugs.json');
      const progsResp = await fetch('exported-programs.json');
      const mapsResp = await fetch('exported-drugs-programs.json');
      
      const drugs = await drugsResp.json();
      const programs = await progsResp.json();
      const mappings = await mapsResp.json();
      
      output.textContent = `Loaded:\n- ${drugs.length} drugs\n- ${programs.length} programs\n- ${mappings.length} mappings\n\nImporting...\n\n`;
      
      // Import drugs
      for (let i = 0; i < drugs.length; i++) {
        const drug = drugs[i];
        const { error } = await supabase.from('drugs').upsert(drug);
        if (error) {
          output.textContent += `Error importing ${drug.medication_name}: ${error.message}\n`;
        } else {
          output.textContent += `✓ Imported ${drug.medication_name}\n`;
        }
      }
      
      output.textContent += '\n';
      
      // Import programs
      for (let i = 0; i < programs.length; i++) {
        const prog = programs[i];
        const { error } = await supabase.from('programs').upsert(prog);
        if (error) {
          output.textContent += `Error importing ${prog.program_name}: ${error.message}\n`;
        } else {
          output.textContent += `✓ Imported ${prog.program_name}\n`;
        }
      }
      
      output.textContent += '\n';
      
      // Import mappings
      for (let i = 0; i < mappings.length; i++) {
        const map = mappings[i];
        const { error } = await supabase.from('drugs_programs').upsert(map);
        if (error) {
          output.textContent += `Error importing mapping: ${error.message}\n`;
        } else {
          output.textContent += `✓ Imported mapping ${i+1}\n`;
        }
      }
      
      output.textContent += '\n✅ ALL DONE!';
      
    } catch (err) {
      output.textContent += `\n\n❌ ERROR: ${err.message}`;
    }
  </script>
</body>
</html>
